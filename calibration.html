<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Calibration</title>
</head>

<body>
    <canvas id="canvas"></canvas>
    <script>
        const img = new Image();
        img.src = 'hairstyle.jpeg';
        img.onload = () => {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = img.naturalWidth;
            canvas.height = img.naturalHeight;
            ctx.drawImage(img, 0, 0);

            const w = canvas.width;
            const h = canvas.height;
            const colWidth = w / 5;
            const scanX = Math.floor(colWidth / 2); // Center of first column

            const imageData = ctx.getImageData(scanX, 0, 1, h);
            const data = imageData.data;

            let segments = [];
            let inSegment = false;
            let startY = 0;

            // Simple detection: look for non-background pixels.
            // Assuming background is either very light or very dark.
            // Let's assume background is the color of pixel (0,0).
            const bgR = data[0];
            const bgG = data[1];
            const bgB = data[2];

            for (let y = 0; y < h; y++) {
                const offset = y * 4;
                const r = data[offset];
                const g = data[offset + 1];
                const b = data[offset + 2];

                const diff = Math.abs(r - bgR) + Math.abs(g - bgG) + Math.abs(b - bgB);
                const isContent = diff > 20; // Tolerance

                if (isContent && !inSegment) {
                    inSegment = true;
                    startY = y;
                } else if (!isContent && inSegment) {
                    inSegment = false;
                    // Filter noise
                    if (y - startY > 50) {
                        segments.push({ start: startY, end: y, height: y - startY });
                    }
                }
            }

            if (inSegment) {
                segments.push({ start: startY, end: h, height: h - startY });
            }

            const result = {
                segments: segments,
                width: w,
                height: h
            };
            document.body.innerText = JSON.stringify(result, null, 2);
            document.body.setAttribute('data-done', 'true');
        };
        img.onerror = (e) => {
            console.error("Error loading image", e);
            document.body.innerText = "Error loading image";
            document.body.setAttribute('data-done', 'error');
        };
    </script>
</body>

</html>